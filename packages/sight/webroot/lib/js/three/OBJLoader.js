THREE.OBJLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t,r,i){var s=this,a=new THREE.XHRLoader(s.manager);a.setPath(this.path),a.load(e,function(e){t(s.parse(e))},r,i)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);this.object&&"function"==typeof this.object._finalize&&this.object._finalize();var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){return{index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:this.groupEnd,groupEnd:-1,groupCount:-1,inherited:!1}}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();return t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),!1!==e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var i=r.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize()},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var i=this.vertices,s=this.object.geometry.vertices;s.push(i[e+0]),s.push(i[e+1]),s.push(i[e+2]),s.push(i[t+0]),s.push(i[t+1]),s.push(i[t+2]),s.push(i[r+0]),s.push(i[r+1]),s.push(i[r+2])},addVertexLine:function(e){var t=this.vertices,r=this.object.geometry.vertices;r.push(t[e+0]),r.push(t[e+1]),r.push(t[e+2])},addNormal:function(e,t,r){var i=this.normals,s=this.object.geometry.normals;s.push(i[e+0]),s.push(i[e+1]),s.push(i[e+2]),s.push(i[t+0]),s.push(i[t+1]),s.push(i[t+2]),s.push(i[r+0]),s.push(i[r+1]),s.push(i[r+2])},addUV:function(e,t,r){var i=this.uvs,s=this.object.geometry.uvs;s.push(i[e+0]),s.push(i[e+1]),s.push(i[t+0]),s.push(i[t+1]),s.push(i[r+0]),s.push(i[r+1])},addUVLine:function(e){var t=this.uvs,r=this.object.geometry.uvs;r.push(t[e+0]),r.push(t[e+1])},addFace:function(e,t,r,i,s,a,n,o,h,l,d,u){var p,c=this.vertices.length,m=this.parseVertexIndex(e,c),f=this.parseVertexIndex(t,c),v=this.parseVertexIndex(r,c);if(void 0===i?this.addVertex(m,f,v):(p=this.parseVertexIndex(i,c),this.addVertex(m,f,p),this.addVertex(f,v,p)),void 0!==s){var g=this.uvs.length;m=this.parseUVIndex(s,g),f=this.parseUVIndex(a,g),v=this.parseUVIndex(n,g),void 0===i?this.addUV(m,f,v):(p=this.parseUVIndex(o,g),this.addUV(m,f,p),this.addUV(f,v,p))}if(void 0!==h){var x=this.normals.length;m=this.parseNormalIndex(h,x),f=h===l?m:this.parseNormalIndex(l,x),v=h===d?m:this.parseNormalIndex(d,x),void 0===i?this.addNormal(m,f,v):(p=this.parseNormalIndex(u,x),this.addNormal(m,f,p),this.addNormal(f,v,p))}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,i=this.uvs.length,s=0,a=e.length;s<a;s++)this.addVertexLine(this.parseVertexIndex(e[s],r));var n=0;for(a=t.length;n<a;n++)this.addUVLine(this.parseUVIndex(t[n],i))}};return e.startObject("",!1),e},parse:function(e){console.time("OBJLoader");var t=this._createParserState();-1!==e.indexOf("\r\n")&&(e=e.replace("\r\n","\n"));for(var r=e.split("\n"),i="",s="",a="",n=[],o="function"==typeof"".trimLeft,h=0,l=r.length;h<l;h++)if(i=r[h],0!==(i=o?i.trimLeft():i.trim()).length&&"#"!==(s=i.charAt(0)))if("v"===s)if(" "===(a=i.charAt(1))&&null!==(n=this.regexp.vertex_pattern.exec(i)))t.vertices.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));else if("n"===a&&null!==(n=this.regexp.normal_pattern.exec(i)))t.normals.push(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));else{if("t"!==a||null===(n=this.regexp.uv_pattern.exec(i)))throw new Error("Unexpected vertex/normal/uv line: '"+i+"'");t.uvs.push(parseFloat(n[1]),parseFloat(n[2]))}else if("f"===s)if(null!==(n=this.regexp.face_vertex_uv_normal.exec(i)))t.addFace(n[1],n[4],n[7],n[10],n[2],n[5],n[8],n[11],n[3],n[6],n[9],n[12]);else if(null!==(n=this.regexp.face_vertex_uv.exec(i)))t.addFace(n[1],n[3],n[5],n[7],n[2],n[4],n[6],n[8]);else if(null!==(n=this.regexp.face_vertex_normal.exec(i)))t.addFace(n[1],n[3],n[5],n[7],void 0,void 0,void 0,void 0,n[2],n[4],n[6],n[8]);else{if(null===(n=this.regexp.face_vertex.exec(i)))throw new Error("Unexpected face line: '"+i+"'");t.addFace(n[1],n[2],n[3],n[4])}else if("l"===s){var d=i.substring(1).trim().split(" "),u=[],p=[];if(-1===i.indexOf("/"))u=d;else for(var c=0,m=d.length;c<m;c++){var f=d[c].split("/");""!==f[0]&&u.push(f[0]),""!==f[1]&&p.push(f[1])}t.addLineGeometry(u,p)}else if(null!==(n=this.regexp.object_pattern.exec(i))){var v=n[0].substr(1).trim();t.startObject(v)}else if(this.regexp.material_use_pattern.test(i))t.object.startMaterial(i.substring(7).trim(),t.materialLibraries);else if(this.regexp.material_library_pattern.test(i))t.materialLibraries.push(i.substring(7).trim());else{if(null===(n=this.regexp.smoothing_pattern.exec(i))){if("\0"===i)continue;throw new Error("Unexpected line: '"+i+"'")}var g=n[1].trim().toLowerCase();t.object.smooth="1"===g||"on"===g,(T=t.object.currentMaterial())&&(T.smooth=t.object.smooth)}t.finalize();var x=new THREE.Group;x.materialLibraries=[].concat(t.materialLibraries);for(h=0,l=t.objects.length;h<l;h++){var E=t.objects[h],b=E.geometry,_=E.materials,j="Line"===b.type;if(0!==b.vertices.length){var y=new THREE.BufferGeometry;y.addAttribute("position",new THREE.BufferAttribute(new Float32Array(b.vertices),3)),b.normals.length>0?y.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(b.normals),3)):y.computeVertexNormals(),b.uvs.length>0&&y.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(b.uvs),2));for(var L,V=[],w=0,H=_.length;w<H;w++){var R=_[w],T=void 0;if(null!==this.materials&&(T=this.materials.create(R.name),j&&T&&!(T instanceof THREE.LineBasicMaterial))){var I=new THREE.LineBasicMaterial;I.copy(T),T=I}T||((T=j?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial).name=R.name),T.shading=R.smooth?THREE.SmoothShading:THREE.FlatShading,V.push(T)}if(V.length>1){for(w=0,H=_.length;w<H;w++){R=_[w];y.addGroup(R.groupStart,R.groupCount,w)}var M=new THREE.MultiMaterial(V);L=j?new THREE.Line(y,M):new THREE.Mesh(y,M)}else L=j?new THREE.Line(y,V[0]):new THREE.Mesh(y,V[0]);L.name=E.name,x.add(L)}}return console.timeEnd("OBJLoader"),x}};